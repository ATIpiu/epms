<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.epms.dao.uniteDao.UniteDao">
    <select id="staffGetProject" resultType="com.epms.entity.Project">
        SELECT pid, pname, pcreatedate, penddate, ptype, cid, pmodelmanagerid,
        pmodelstaff, prendermanagerid, prenderstaff, paftermanagerid, pafterstaff,
        pperiodstatus, pprojectstatus, pfileurl, pmodelwage, prenderwage, pafterwage
        FROM project
        WHERE pId IN (SELECT pId FROM selectproject WHERE sId=#{sId})
    </select>

    <select id="clientGetCommitLog" resultType="com.epms.entity.CommitLog">
        SELECT sId, pId, cCreateTime, sType, cFeedback, cResponseType
        FROM commitlog
        WHERE cType=2 AND pId IN (SELECT pId FROM project WHERE cId =#{cId})
    </select>

    <select id="managerGetCommitLog" resultType="com.epms.entity.CommitLog">

        SELECT sId, pId, cCreateTime, cType, cFeedback, cResponseType
        FROM commitlog
        WHERE cType=1 AND pId in
        (SELECT pId FROM project WHERE
        (<if test="type==1">pModelManagerId </if><if test="type==2"> pRenderManagerId</if><if test="type==3"> pAfterManagerId</if>)
        =#{sId})
        AND sId in (SELECT sId  FROM staff WHERE sType=#{type}+3 OR sType=#{type}+6)
    </select>

</mapper>